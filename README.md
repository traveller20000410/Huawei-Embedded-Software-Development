# Huawei-Embedded-Software-Development

本次题目来自 2025 华为嵌入式软件大赛 算法组，核心任务是针对“边缘集群 AI 推理的分布式任务调度”设计高效算法。题目要点如下：

多用户请求：共有 $M$ 位用户，在各自的时间窗口 $[s_i, e_i)$ 内提交若干推理样本请求，总样本数为 $cnt_i$；
异构服务器：存在 $N$ 种服务器类型，第 $i$ 类服务器有 $g_i$ 台，每台显存大小为 $m_i$，推理速度参数为 $k_i$；
通信时延：用户 $j$ 将请求发送到第 $i$ 类服务器需延迟 $\text{latency}[i][j]$ 毫秒；
显存与批大小约束：对单台服务器，若批处理大小为 $B$，则必须满足 $a \times B + b \le m$ 的显存限制；
调度目标：在 30 s 时间和 512 MB 空间限制下，调度所有请求以最大化综合得分，得分与每个用户完成最后一个样本的时刻、迁移次数等有关。

### 解题思路

下面是扩展后的 **解题思路** 部分，增加了更多细节说明，方便他人更好地理解算法设计：

---

### 解题思路（扩展）

1. **事件驱动的时间推进**

   * 我们将时间线上的两类关键事件：

     1. **用户可发送下一批请求的时刻**（基于每个用户的 $s_i$ 及上一次发送后的冷却时间）；
     2. **各 NPU（神经网络处理单元）空闲的时刻**（上一次完成推理后的时间）；
   * 每次只跳转到「下一最近事件」而非逐毫秒扫描，避免了大量无效的循环，大幅降低了时间复杂度。

2. **批大小与显存约束**

   * 针对每个服务器类型，显存约束由线性不等式 $a \times B + b \le m$ 决定最大可用批大小 $B_{\max}$。
   * 在选定某一用户和 NPU 时，我们将该用户剩余样本数 $\mathrm{rem}_i$ 与 $B_{\max}$ 比较，取两者的较小值作为本次调度批量。

3. **得分模型与贪心分配**

   * **基础吞吐**：批量 $B$ 完成时间按 $\lceil B / (k_i \sqrt{B}) \rceil$ 估算，吞吐量为 $B/\text{proc}$。
   * **紧迫度加权**：结合用户剩余时间窗宽度 $(e_i - t)$ 与剩余样本数 $\mathrm{rem}_i$，定义紧迫度因子

     $$
       U = 1 + \frac{W_{\text{deadline}}}{\max(1, \,(e_i - t)/\mathrm{rem}_i)}.
     $$

     这样，越接近截止、样本越多的用户得分越被放大。
   * **迁移惩罚**：若连续任务从不同 NPU 调度，会给得分扣除固定惩罚 $P_{\text{mig}}$，避免频繁在节点间迁移造成缓存抖动。
   * **高性能折扣**：预先根据所有服务器 $k$ 的分位阈值标记高性能节点，当用户正处于「宽松期」时分配到高性能节点，可额外乘以一个小于 1 的折扣因子，鼓励在快到期的任务上优先使用高性能资源。
   * **全局候选排序**：对每个空闲 NPU，枚举所有当前可调度的用户，生成 $\langle\text{得分},\text{NPU},\text{用户},B\rangle$ 列表，并按得分降序；然后依次为不同用户分配最优 NPU，保证同一时刻每个用户只分一次，避免分配冲突。

4. **状态更新与循环**

   * 成功分配后：

     * 更新该 NPU 的下次空闲时间为 $\;t_{\text{start}} + \text{proc}$；
     * 更新用户的剩余样本 $\mathrm{rem}_i \gets \mathrm{rem}_i - B$，和下一次可发送时间为 $\,t_{\text{send}} + 1$；
   * 若当前时刻无可分配任务，时间前进到下一事件。
   * 重复上述流程，直至所有样本调度完成或无可执行事件。

5. **复杂度与性能**

   * **事件数** 最多为 $O(\sum g_i + M)$ 次跳转；
   * 每次事件处理需遍历所有空闲 NPU 与可用用户，费用约为 $O((\sum g_i)\times M)$，再加上对候选列表的排序 $O(K\log K)$（$K$ 为候选对数量）。
   * 在 $30$ 秒内完成数万次决策，整个调度过程高效可行。

6. **可扩展性 & 可测性**

   * 算法模块化：

     * **输入/输出** 与 **调度逻辑** 完全解耦，可独立单元测试；
     * 如需调整得分模型、引入新的约束或增强迁移策略，只需修改局部函数，无须改动整体框架。
   * 支持多种参数灵活配置：

     * 延迟权重、截止权重、迁移惩罚、显存模型系数等均可通过头文件快速调节，方便做性能对比实验。

该方案通过**事件驱动**、**全局贪心**与**加权得分**三大核心思想，在保持高吞吐的同时兼顾时延和迁移稳定性，最终在比赛环境中取得了优异的综合表现。欢迎在代码目录下查看各模块注释和参数说明！

